{"ast":null,"code":"import { print as printWindow, createElement, isNullOrUndefined, Browser } from '@syncfusion/ej2-base';\nimport { SvgRenderer } from '@syncfusion/ej2-svg-base';\nimport { getElement, removeElement } from '../utils/helper';\nimport { beforePrint } from '../model/constants';\nimport { PdfPageOrientation, PdfDocument, PdfBitmap, SizeF } from '@syncfusion/ej2-pdf-export';\n\nvar ExportUtils =\n/** @class */\nfunction () {\n  /**\n   * Constructor for chart and accumulation annotation\n   * @param control\n   */\n  function ExportUtils(control) {\n    this.control = control;\n  }\n  /**\n   * To print the accumulation and chart elements\n   * @param elements\n   */\n\n\n  ExportUtils.prototype.print = function (elements) {\n    this.printWindow = window.open('', 'print', 'height=' + window.outerHeight + ',width=' + window.outerWidth + ',tabbar=no');\n    this.printWindow.moveTo(0, 0);\n    this.printWindow.resizeTo(screen.availWidth, screen.availHeight);\n    var argsData = {\n      cancel: false,\n      htmlContent: this.getHTMLContent(elements),\n      name: beforePrint\n    };\n    this.control.trigger(beforePrint, argsData);\n\n    if (!argsData.cancel) {\n      printWindow(argsData.htmlContent, this.printWindow);\n    }\n  };\n  /**\n   * To get the html string of the chart and accumulation\n   * @param elements\n   * @private\n   */\n\n\n  ExportUtils.prototype.getHTMLContent = function (elements) {\n    var div = createElement('div');\n\n    if (elements) {\n      if (elements instanceof Array) {\n        elements.forEach(function (value) {\n          div.appendChild(getElement(value).cloneNode(true));\n        });\n      } else if (elements instanceof Element) {\n        div.appendChild(elements.cloneNode(true));\n      } else {\n        div.appendChild(getElement(elements).cloneNode(true));\n      }\n    } else {\n      div.appendChild(this.control.element.cloneNode(true));\n    }\n\n    return div;\n  };\n  /**\n   * To export the file as image/svg format\n   * @param type\n   * @param fileName\n   */\n\n\n  ExportUtils.prototype.export = function (type, fileName, orientation, controls, width, height, isVertical) {\n    var _this = this;\n\n    var controlValue = this.getControlsValue(controls, isVertical);\n    width = width ? width : controlValue.width;\n    height = height ? height : controlValue.height;\n    var element = this.control.svgObject;\n    var isCanvas = this.control.enableCanvas;\n    var image;\n\n    if (!isCanvas) {\n      element = createElement('canvas', {\n        id: 'ej2-canvas',\n        attrs: {\n          'width': width.toString(),\n          'height': height.toString()\n        }\n      });\n    }\n\n    var isDownload = !(Browser.userAgent.toString().indexOf('HeadlessChrome') > -1);\n    orientation = isNullOrUndefined(orientation) ? PdfPageOrientation.Landscape : orientation;\n    var svgData = '<svg xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">' + controlValue.svg.outerHTML + '</svg>';\n    var url = window.URL.createObjectURL(new Blob(type === 'SVG' ? [svgData] : [new XMLSerializer().serializeToString(controlValue.svg)], {\n      type: 'image/svg+xml'\n    }));\n\n    if (type === 'SVG') {\n      if (Browser.info.name === 'msie') {\n        var svg = new Blob([new XMLSerializer().serializeToString(controlValue.svg)], {\n          type: 'application/octet-stream'\n        });\n        window.navigator.msSaveOrOpenBlob(svg, fileName + '.' + type.toLocaleLowerCase());\n      } else {\n        this.triggerDownload(fileName, type, url, isDownload);\n      }\n    } else if (Browser.info.name === 'msie') {\n      var canvas = element;\n\n      if (!isCanvas) {\n        canvas = this.createCanvas();\n      }\n\n      image = canvas.toDataURL();\n\n      if (type === 'PDF') {\n        this.exportPdf(canvas, orientation, width, height, isDownload, fileName);\n      } else {\n        this.doexport(type, image, fileName);\n      }\n    } else {\n      var image_1 = new Image();\n      var ctx_1 = element.getContext('2d');\n\n      image_1.onload = function () {\n        ctx_1.drawImage(image_1, 0, 0);\n        window.URL.revokeObjectURL(url);\n\n        if (type === 'PDF') {\n          _this.exportPdf(element, orientation, width, height, isDownload, fileName);\n        } else {\n          if (window.navigator.msSaveOrOpenBlob) {\n            window.navigator.msSaveOrOpenBlob(element.msToBlob(), fileName + '.' + type.toLocaleLowerCase());\n          } else {\n            _this.triggerDownload(fileName, type, element.toDataURL('image/png').replace('image/png', 'image/octet-stream'), isDownload);\n          }\n        }\n      };\n\n      image_1.src = url;\n    }\n\n    if (!isCanvas) {\n      removeElement(document.getElementById(this.control.element.id + '_canvas'));\n    }\n  };\n  /**\n   * To trigger the download element\n   * @param fileName\n   * @param type\n   * @param url\n   */\n\n\n  ExportUtils.prototype.triggerDownload = function (fileName, type, url, isDownload) {\n    createElement('a', {\n      attrs: {\n        'download': fileName + '.' + type.toLocaleLowerCase(),\n        'href': url\n      }\n    }).dispatchEvent(new MouseEvent(isDownload ? 'click' : 'move', {\n      view: window,\n      bubbles: false,\n      cancelable: true\n    }));\n  };\n  /**\n   * To get the maximum size value\n   * @param controls\n   * @param name\n   */\n\n\n  ExportUtils.prototype.getControlsValue = function (controls, isVertical) {\n    var width = 0;\n    var height = 0;\n    var content = '';\n    var isCanvas = this.control.enableCanvas;\n    var svgObject = new SvgRenderer('').createSvg({\n      id: 'Svg_Export_Element',\n      width: 200,\n      height: 200\n    });\n    controls.map(function (control) {\n      var svg = control.svgObject.cloneNode(true);\n      var groupEle = control.renderer.createGroup({\n        style: isNullOrUndefined(isVertical) || isVertical ? 'transform: translateY(' + height + 'px)' : 'transform: translateX(' + width + 'px)'\n      });\n\n      if (!isCanvas) {\n        groupEle.appendChild(svg);\n      }\n\n      width = isNullOrUndefined(isVertical) || isVertical ? Math.max(control.availableSize.width, width) : width + control.availableSize.width;\n      height = isNullOrUndefined(isVertical) || isVertical ? height + control.availableSize.height : Math.max(control.availableSize.height, height);\n      content += control.svgObject.outerHTML;\n\n      if (!isCanvas) {\n        svgObject.appendChild(groupEle);\n      }\n    });\n\n    if (!isCanvas) {\n      svgObject.setAttribute('width', width + '');\n      svgObject.setAttribute('height', height + '');\n    }\n\n    return {\n      'width': width,\n      'height': height,\n      'svg': svgObject\n    };\n  };\n\n  ExportUtils.prototype.createCanvas = function () {\n    var chart = this.control;\n    this.canvasRender(true, chart);\n    var canvas = chart.svgObject;\n    this.canvasRender(false, chart);\n    return canvas;\n  };\n  /**\n   * To convert svg chart into canvas chart to fix export issue in IE\n   * We cant export svg to other formats in IE\n   */\n  // tslint:disable:no-string-literal\n\n\n  ExportUtils.prototype.canvasRender = function (enableCanvas, chart) {\n    chart.enableCanvas = enableCanvas;\n    chart['preRender']();\n    chart['render']();\n  };\n\n  ExportUtils.prototype.exportPdf = function (element, orientation, width, height, isDownload, fileName) {\n    var document = new PdfDocument();\n    var margin = document.pageSettings.margins;\n    var pdfDefaultWidth = document.pageSettings.width;\n    var pdfDefaultHeight = document.pageSettings.height;\n    var exactWidth;\n    var exactHeight;\n    var imageString = element.toDataURL('image/jpeg').replace('image/jpeg', 'image/octet-stream');\n    document.pageSettings.orientation = orientation;\n    exactWidth = pdfDefaultWidth < width ? width + margin.left + margin.right : pdfDefaultWidth;\n    exactHeight = pdfDefaultHeight < height ? height + margin.top + margin.bottom : pdfDefaultHeight;\n    document.pageSettings.size = new SizeF(exactWidth, exactHeight);\n    imageString = imageString.slice(imageString.indexOf(',') + 1);\n    document.pages.add().graphics.drawImage(new PdfBitmap(imageString), 0, 0, width, height);\n\n    if (isDownload) {\n      document.save(fileName + '.pdf');\n      document.destroy();\n    }\n  };\n\n  ExportUtils.prototype.doexport = function (type, image, fileName) {\n    var images = [];\n    var fileType = type || 'JPG';\n    images = [image];\n    this.exportImage(images, fileName, fileType, image);\n  };\n\n  ExportUtils.prototype.exportImage = function (images, fileName, fileType, image) {\n    var buffers = [];\n    var length = !(images instanceof HTMLElement) ? images.length : 0;\n\n    for (var g = 0; g < length; g++) {\n      image = images[g];\n      image = image.replace(/^data:[a-z]*;,/, '');\n      var image1 = image.split(',');\n      var byteString = atob(image1[1]);\n      var buffer = new ArrayBuffer(byteString.length);\n      var intArray = new Uint8Array(buffer);\n\n      for (var i = 0; i < byteString.length; i++) {\n        intArray[i] = byteString.charCodeAt(i);\n      }\n\n      buffers.push(buffer);\n    }\n\n    for (var j = 0; j < buffers.length; j++) {\n      var b = new Blob([buffers[j]], {\n        type: 'application/octet-stream'\n      });\n\n      if (Browser.info.name === 'msie') {\n        window.navigator.msSaveOrOpenBlob(b, fileName + '.' + fileType.toLocaleLowerCase());\n      }\n    }\n  };\n\n  return ExportUtils;\n}();\n\nexport { ExportUtils };","map":null,"metadata":{},"sourceType":"module"}