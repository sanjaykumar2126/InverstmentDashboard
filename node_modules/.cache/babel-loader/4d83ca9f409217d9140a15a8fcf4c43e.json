{"ast":null,"code":"import ScatterChart from '../scatter-charts/scatter-chart';\nimport Bubble from './bubble';\nimport { INITIAL_ANIMATION_DURATION, BUBBLE } from '../constants';\nimport { MIN_VALUE, CIRCLE } from '../../common/constants';\nimport { deepExtend, isFunction, setDefaultOptions, valueOrDefault } from '../../common';\n\nvar BubbleChart = function (ScatterChart) {\n  function BubbleChart() {\n    ScatterChart.apply(this, arguments);\n  }\n\n  if (ScatterChart) BubbleChart.__proto__ = ScatterChart;\n  BubbleChart.prototype = Object.create(ScatterChart && ScatterChart.prototype);\n  BubbleChart.prototype.constructor = BubbleChart;\n\n  BubbleChart.prototype._initFields = function _initFields() {\n    this._maxSize = MIN_VALUE;\n\n    ScatterChart.prototype._initFields.call(this);\n  };\n\n  BubbleChart.prototype.addValue = function addValue(value, fields) {\n    if (value.size !== null && (value.size > 0 || value.size < 0 && fields.series.negativeValues.visible)) {\n      this._maxSize = Math.max(this._maxSize, Math.abs(value.size));\n      ScatterChart.prototype.addValue.call(this, value, fields);\n    } else {\n      this.points.push(null);\n      this.seriesPoints[fields.seriesIx].push(null);\n    }\n  };\n\n  BubbleChart.prototype.reflow = function reflow(box) {\n    this.updateBubblesSize(box);\n    ScatterChart.prototype.reflow.call(this, box);\n  };\n\n  BubbleChart.prototype.pointType = function pointType() {\n    return Bubble;\n  };\n\n  BubbleChart.prototype.createPoint = function createPoint(value, fields) {\n    var series = fields.series;\n    var pointsCount = series.data.length;\n    var delay = fields.pointIx * (INITIAL_ANIMATION_DURATION / pointsCount);\n    var animationOptions = {\n      delay: delay,\n      duration: INITIAL_ANIMATION_DURATION - delay,\n      type: BUBBLE\n    };\n    var color = fields.color || series.color;\n\n    if (value.size < 0 && series.negativeValues.visible) {\n      color = valueOrDefault(series.negativeValues.color, color);\n    }\n\n    var pointOptions = deepExtend({\n      labels: {\n        animation: {\n          delay: delay,\n          duration: INITIAL_ANIMATION_DURATION - delay\n        }\n      }\n    }, this.pointOptions(series, fields.seriesIx), {\n      markers: {\n        type: CIRCLE,\n        border: series.border,\n        opacity: series.opacity,\n        animation: animationOptions\n      }\n    });\n    pointOptions = this.evalPointOptions(pointOptions, value, fields);\n\n    if (isFunction(series.color)) {\n      color = pointOptions.color;\n    }\n\n    pointOptions.markers.background = color;\n    var point = new Bubble(value, pointOptions);\n    point.color = color;\n    this.append(point);\n    return point;\n  };\n\n  BubbleChart.prototype.updateBubblesSize = function updateBubblesSize(box) {\n    var this$1 = this;\n    var ref = this;\n    var series = ref.options.series;\n    var boxSize = Math.min(box.width(), box.height());\n\n    for (var seriesIx = 0; seriesIx < series.length; seriesIx++) {\n      var currentSeries = series[seriesIx];\n      var seriesPoints = this$1.seriesPoints[seriesIx];\n      var minSize = currentSeries.minSize || Math.max(boxSize * 0.02, 10);\n      var maxSize = currentSeries.maxSize || boxSize * 0.2;\n      var minR = minSize / 2;\n      var maxR = maxSize / 2;\n      var minArea = Math.PI * minR * minR;\n      var maxArea = Math.PI * maxR * maxR;\n      var areaRange = maxArea - minArea;\n      var areaRatio = areaRange / this$1._maxSize;\n\n      for (var pointIx = 0; pointIx < seriesPoints.length; pointIx++) {\n        var point = seriesPoints[pointIx];\n\n        if (point) {\n          var area = Math.abs(point.value.size) * areaRatio;\n          var radius = Math.sqrt((minArea + area) / Math.PI);\n          var baseZIndex = valueOrDefault(point.options.zIndex, 0);\n          var zIndex = baseZIndex + (1 - radius / maxR);\n          deepExtend(point.options, {\n            zIndex: zIndex,\n            markers: {\n              size: radius * 2,\n              zIndex: zIndex\n            },\n            labels: {\n              zIndex: zIndex + 1\n            }\n          });\n        }\n      }\n    }\n  };\n\n  BubbleChart.prototype.formatPointValue = function formatPointValue(point, format) {\n    var value = point.value;\n    return this.chartService.format.auto(format, value.x, value.y, value.size, point.category);\n  };\n\n  BubbleChart.prototype.createAnimation = function createAnimation() {};\n\n  BubbleChart.prototype.createVisual = function createVisual() {};\n\n  return BubbleChart;\n}(ScatterChart);\n\nsetDefaultOptions(BubbleChart, {\n  tooltip: {\n    format: \"{3}\"\n  },\n  labels: {\n    format: \"{3}\"\n  }\n});\nexport default BubbleChart;","map":null,"metadata":{},"sourceType":"module"}