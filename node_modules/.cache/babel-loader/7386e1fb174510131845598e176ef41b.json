{"ast":null,"code":"import CategoricalChart from '../categorical-chart';\nimport ClusterLayout from '../layout/cluster-layout';\nimport Candlestick from './candlestick';\nimport ClipAnimationMixin from '../mixins/clip-animation-mixin';\nimport { CANDLESTICK } from '../constants';\nimport areNumbers from '../utils/are-numbers';\nimport { MIN_VALUE, MAX_VALUE } from '../../common/constants';\nimport { deepExtend, isFunction } from '../../common';\n\nvar CandlestickChart = function (CategoricalChart) {\n  function CandlestickChart() {\n    CategoricalChart.apply(this, arguments);\n  }\n\n  if (CategoricalChart) CandlestickChart.__proto__ = CategoricalChart;\n  CandlestickChart.prototype = Object.create(CategoricalChart && CategoricalChart.prototype);\n  CandlestickChart.prototype.constructor = CandlestickChart;\n\n  CandlestickChart.prototype.reflowCategories = function reflowCategories(categorySlots) {\n    var children = this.children;\n    var childrenLength = children.length;\n\n    for (var i = 0; i < childrenLength; i++) {\n      children[i].reflow(categorySlots[i]);\n    }\n  };\n\n  CandlestickChart.prototype.addValue = function addValue(data, fields) {\n    var categoryIx = fields.categoryIx;\n    var category = fields.category;\n    var series = fields.series;\n    var seriesIx = fields.seriesIx;\n    var ref = this;\n    var children = ref.children;\n    var options = ref.options;\n    var value = data.valueFields;\n    var valueParts = this.splitValue(value);\n    var hasValue = areNumbers(valueParts);\n    var dataItem = series.data[categoryIx];\n    var categoryPoints = this.categoryPoints[categoryIx];\n    var point;\n\n    if (!categoryPoints) {\n      this.categoryPoints[categoryIx] = categoryPoints = [];\n    }\n\n    if (hasValue) {\n      point = this.createPoint(data, fields);\n    }\n\n    var cluster = children[categoryIx];\n\n    if (!cluster) {\n      cluster = new ClusterLayout({\n        vertical: options.invertAxes,\n        gap: options.gap,\n        spacing: options.spacing,\n        rtl: !options.invertAxes && (this.chartService || {}).rtl\n      });\n      this.append(cluster);\n    }\n\n    if (point) {\n      this.updateRange(value, fields);\n      cluster.append(point);\n      point.categoryIx = categoryIx;\n      point.category = category;\n      point.series = series;\n      point.seriesIx = seriesIx;\n      point.owner = this;\n      point.dataItem = dataItem;\n      point.noteText = data.fields.noteText;\n    }\n\n    this.points.push(point);\n    categoryPoints.push(point);\n  };\n\n  CandlestickChart.prototype.pointType = function pointType() {\n    return Candlestick;\n  };\n\n  CandlestickChart.prototype.createPoint = function createPoint(data, fields) {\n    var categoryIx = fields.categoryIx;\n    var category = fields.category;\n    var series = fields.series;\n    var seriesIx = fields.seriesIx;\n    var pointType = this.pointType();\n    var value = data.valueFields;\n    var pointOptions = deepExtend({}, series);\n    var color = data.fields.color || series.color;\n    pointOptions = this.evalPointOptions(pointOptions, value, category, categoryIx, series, seriesIx);\n\n    if (series.type === CANDLESTICK) {\n      if (value.open > value.close) {\n        color = data.fields.downColor || series.downColor || series.color;\n      }\n    }\n\n    if (isFunction(series.color)) {\n      color = pointOptions.color;\n    }\n\n    pointOptions.vertical = !this.options.invertAxes;\n    var point = new pointType(value, pointOptions);\n    point.color = color;\n    return point;\n  };\n\n  CandlestickChart.prototype.splitValue = function splitValue(value) {\n    return [value.low, value.open, value.close, value.high];\n  };\n\n  CandlestickChart.prototype.updateRange = function updateRange(value, fields) {\n    var axisName = fields.series.axis;\n    var parts = this.splitValue(value);\n    var axisRange = this.valueAxisRanges[axisName];\n    axisRange = this.valueAxisRanges[axisName] = axisRange || {\n      min: MAX_VALUE,\n      max: MIN_VALUE\n    };\n    axisRange = this.valueAxisRanges[axisName] = {\n      min: Math.min.apply(Math, parts.concat([axisRange.min])),\n      max: Math.max.apply(Math, parts.concat([axisRange.max]))\n    };\n  };\n\n  CandlestickChart.prototype.formatPointValue = function formatPointValue(point, format) {\n    var value = point.value;\n    return this.chartService.format.auto(format, value.open, value.high, value.low, value.close, point.category);\n  };\n\n  CandlestickChart.prototype.animationPoints = function animationPoints() {\n    return this.points;\n  };\n\n  return CandlestickChart;\n}(CategoricalChart);\n\ndeepExtend(CandlestickChart.prototype, ClipAnimationMixin);\nexport default CandlestickChart;","map":null,"metadata":{},"sourceType":"module"}