{"ast":null,"code":"import ChartElement from './chart-element';\nimport Box from './box';\nimport { X, Y, WIDTH, HEIGHT, RIGHT, BOTTOM, CENTER } from '../common/constants';\nimport { round, setDefaultOptions } from '../common';\n\nvar FloatElement = function (ChartElement) {\n  function FloatElement(options) {\n    ChartElement.call(this, options);\n\n    this._initDirection();\n  }\n\n  if (ChartElement) FloatElement.__proto__ = ChartElement;\n  FloatElement.prototype = Object.create(ChartElement && ChartElement.prototype);\n  FloatElement.prototype.constructor = FloatElement;\n\n  FloatElement.prototype._initDirection = function _initDirection() {\n    var options = this.options;\n\n    if (options.vertical) {\n      this.groupAxis = X;\n      this.elementAxis = Y;\n      this.groupSizeField = WIDTH;\n      this.elementSizeField = HEIGHT;\n      this.groupSpacing = options.spacing;\n      this.elementSpacing = options.vSpacing;\n    } else {\n      this.groupAxis = Y;\n      this.elementAxis = X;\n      this.groupSizeField = HEIGHT;\n      this.elementSizeField = WIDTH;\n      this.groupSpacing = options.vSpacing;\n      this.elementSpacing = options.spacing;\n    }\n  };\n\n  FloatElement.prototype.reflow = function reflow(targetBox) {\n    this.box = targetBox.clone();\n    this.reflowChildren();\n  };\n\n  FloatElement.prototype.reflowChildren = function reflowChildren() {\n    var this$1 = this;\n    var ref = this;\n    var box = ref.box;\n    var elementAxis = ref.elementAxis;\n    var groupAxis = ref.groupAxis;\n    var elementSizeField = ref.elementSizeField;\n    var groupSizeField = ref.groupSizeField;\n    var ref$1 = this.groupOptions();\n    var groups = ref$1.groups;\n    var groupsSize = ref$1.groupsSize;\n    var maxGroupElementsSize = ref$1.maxGroupElementsSize;\n    var groupsCount = groups.length;\n    var groupsStart = box[groupAxis + 1] + this.alignStart(groupsSize, box[groupSizeField]());\n\n    if (groupsCount) {\n      var groupStart = groupsStart;\n\n      for (var groupIdx = 0; groupIdx < groupsCount; groupIdx++) {\n        var group = groups[groupIdx];\n        var groupElements = group.groupElements;\n        var elementStart = box[elementAxis + 1];\n        var groupElementsCount = groupElements.length;\n\n        for (var idx = 0; idx < groupElementsCount; idx++) {\n          var element = groupElements[idx];\n          var elementSize = this$1.elementSize(element);\n          var groupElementStart = groupStart + this$1.alignStart(elementSize[groupSizeField], group.groupSize);\n          var elementBox = new Box();\n          elementBox[groupAxis + 1] = groupElementStart;\n          elementBox[groupAxis + 2] = groupElementStart + elementSize[groupSizeField];\n          elementBox[elementAxis + 1] = elementStart;\n          elementBox[elementAxis + 2] = elementStart + elementSize[elementSizeField];\n          element.reflow(elementBox);\n          elementStart += elementSize[elementSizeField] + this$1.elementSpacing;\n        }\n\n        groupStart += group.groupSize + this$1.groupSpacing;\n      }\n\n      box[groupAxis + 1] = groupsStart;\n      box[groupAxis + 2] = groupsStart + groupsSize;\n      box[elementAxis + 2] = box[elementAxis + 1] + maxGroupElementsSize;\n    }\n  };\n\n  FloatElement.prototype.alignStart = function alignStart(size, maxSize) {\n    var start = 0;\n    var align = this.options.align;\n\n    if (align === RIGHT || align === BOTTOM) {\n      start = maxSize - size;\n    } else if (align === CENTER) {\n      start = (maxSize - size) / 2;\n    }\n\n    return start;\n  };\n\n  FloatElement.prototype.groupOptions = function groupOptions() {\n    var this$1 = this;\n    var ref = this;\n    var box = ref.box;\n    var children = ref.children;\n    var elementSizeField = ref.elementSizeField;\n    var groupSizeField = ref.groupSizeField;\n    var elementSpacing = ref.elementSpacing;\n    var groupSpacing = ref.groupSpacing;\n    var maxSize = round(box[elementSizeField]());\n    var childrenCount = children.length;\n    var groups = [];\n    var groupSize = 0;\n    var groupElementsSize = 0;\n    var groupsSize = 0;\n    var maxGroupElementsSize = 0;\n    var groupElements = [];\n\n    for (var idx = 0; idx < childrenCount; idx++) {\n      var element = children[idx];\n\n      if (!element.box) {\n        element.reflow(box);\n      }\n\n      var elementSize = this$1.elementSize(element);\n\n      if (this$1.options.wrap && round(groupElementsSize + elementSpacing + elementSize[elementSizeField]) > maxSize) {\n        groups.push({\n          groupElements: groupElements,\n          groupSize: groupSize,\n          groupElementsSize: groupElementsSize\n        });\n        maxGroupElementsSize = Math.max(maxGroupElementsSize, groupElementsSize);\n        groupsSize += groupSpacing + groupSize;\n        groupSize = 0;\n        groupElementsSize = 0;\n        groupElements = [];\n      }\n\n      groupSize = Math.max(groupSize, elementSize[groupSizeField]);\n\n      if (groupElementsSize > 0) {\n        groupElementsSize += elementSpacing;\n      }\n\n      groupElementsSize += elementSize[elementSizeField];\n      groupElements.push(element);\n    }\n\n    groups.push({\n      groupElements: groupElements,\n      groupSize: groupSize,\n      groupElementsSize: groupElementsSize\n    });\n    maxGroupElementsSize = Math.max(maxGroupElementsSize, groupElementsSize);\n    groupsSize += groupSize;\n    return {\n      groups: groups,\n      groupsSize: groupsSize,\n      maxGroupElementsSize: maxGroupElementsSize\n    };\n  };\n\n  FloatElement.prototype.elementSize = function elementSize(element) {\n    return {\n      width: element.box.width(),\n      height: element.box.height()\n    };\n  };\n\n  FloatElement.prototype.createVisual = function createVisual() {};\n\n  return FloatElement;\n}(ChartElement);\n\nsetDefaultOptions(FloatElement, {\n  vertical: true,\n  wrap: true,\n  vSpacing: 0,\n  spacing: 0\n});\nexport default FloatElement;","map":null,"metadata":{},"sourceType":"module"}