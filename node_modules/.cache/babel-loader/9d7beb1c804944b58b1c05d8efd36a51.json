{"ast":null,"code":"import { geometry as geo, drawing } from '@progress/kendo-drawing';\nimport { Class, elementSize, setDefaultOptions, deepExtend, isArray, isNumber } from '../common';\nimport { DEFAULT_WIDTH, DEFAULT_HEIGHT } from './constants';\nimport { ChartService } from '../services';\nimport { unpad } from './utils';\nvar DEFAULT_MARGIN = 5;\nvar Path = drawing.Path;\nvar Surface = drawing.Surface;\n\nvar Gauge = function (Class) {\n  function Gauge(element, userOptions, theme, context) {\n    if (context === void 0) context = {};\n    Class.call(this);\n    this.element = element;\n    this.theme = theme;\n    this.contextService = new ChartService(this, context);\n    this._originalOptions = deepExtend({}, this.options, userOptions);\n    this.options = deepExtend({}, this._originalOptions);\n\n    this._initTheme(theme);\n\n    this.redraw();\n  }\n\n  if (Class) Gauge.__proto__ = Class;\n  Gauge.prototype = Object.create(Class && Class.prototype);\n  Gauge.prototype.constructor = Gauge;\n\n  Gauge.prototype.destroy = function destroy() {\n    if (this.surface) {\n      this.surface.destroy();\n      this.surface = null;\n    }\n\n    delete this.element;\n    delete this.surfaceElement;\n  };\n\n  Gauge.prototype.value = function value(pointerValue) {\n    var pointer = this.pointers[0];\n\n    if (arguments.length === 0) {\n      return pointer.value();\n    }\n\n    pointer.value(pointerValue);\n\n    this._setValueOptions(pointerValue);\n  };\n\n  Gauge.prototype._draw = function _draw() {\n    var surface = this.surface;\n    surface.clear();\n    surface.draw(this._visuals);\n  };\n\n  Gauge.prototype.exportVisual = function exportVisual() {\n    return this._visuals;\n  };\n\n  Gauge.prototype.allValues = function allValues(values) {\n    var pointers = this.pointers;\n    var allValues = [];\n\n    if (arguments.length === 0) {\n      for (var i = 0; i < pointers.length; i++) {\n        allValues.push(pointers[i].value());\n      }\n\n      return allValues;\n    }\n\n    if (isArray(values)) {\n      for (var i$1 = 0; i$1 < values.length; i$1++) {\n        if (isNumber(values[i$1])) {\n          pointers[i$1].value(values[i$1]);\n        }\n      }\n    }\n\n    this._setValueOptions(values);\n  };\n\n  Gauge.prototype._setValueOptions = function _setValueOptions(values) {\n    var pointers = [].concat(this.options.pointer);\n    var arrayValues = [].concat(values);\n\n    for (var i = 0; i < arrayValues.length; i++) {\n      pointers[i].value = arrayValues[i];\n    }\n  };\n\n  Gauge.prototype.resize = function resize() {\n    this.noTransitionsRedraw();\n  };\n\n  Gauge.prototype.noTransitionsRedraw = function noTransitionsRedraw() {\n    var transitions = this.options.transitions;\n\n    this._toggleTransitions(false);\n\n    this.redraw();\n\n    this._toggleTransitions(transitions);\n  };\n\n  Gauge.prototype.redraw = function redraw() {\n    var size = this._surfaceSize();\n\n    var wrapper = new geo.Rect([0, 0], [size.width, size.height]);\n\n    this._initSurface();\n\n    this.gaugeArea = this._createGaugeArea();\n\n    this._createModel();\n\n    var bbox = unpad(wrapper.bbox(), this._gaugeAreaMargin);\n    this.reflow(bbox);\n  };\n\n  Gauge.prototype.setOptions = function setOptions(options, theme) {\n    this._originalOptions = deepExtend(this._originalOptions, options);\n    this.options = deepExtend({}, this._originalOptions);\n\n    this._initTheme(theme);\n\n    this.redraw();\n  };\n\n  Gauge.prototype.setDirection = function setDirection(rtl) {\n    this.contextService.rtl = Boolean(rtl);\n\n    if (this.surface && this.surface.type === 'svg') {\n      this.surface.destroy();\n      this.surface = null;\n    }\n  };\n\n  Gauge.prototype.setIntlService = function setIntlService(intl) {\n    this.contextService.intl = intl;\n  };\n\n  Gauge.prototype._initTheme = function _initTheme(theme) {\n    var currentTheme = theme || this.theme || {};\n    this.theme = currentTheme;\n    this.options = deepExtend({}, currentTheme, this.options);\n    var options = this.options;\n    var pointer = options.pointer;\n\n    if (isArray(pointer)) {\n      var pointers = [];\n\n      for (var i = 0; i < pointer.length; i++) {\n        pointers.push(deepExtend({}, currentTheme.pointer, pointer[i]));\n      }\n\n      options.pointer = pointers;\n    }\n  };\n\n  Gauge.prototype._createGaugeArea = function _createGaugeArea() {\n    var options = this.options.gaugeArea;\n    var size = this.surface.size();\n    var border = options.border || {};\n    var areaGeometry = new geo.Rect([0, 0], [size.width, size.height]);\n    this._gaugeAreaMargin = options.margin || DEFAULT_MARGIN;\n\n    if (border.width > 0) {\n      areaGeometry = unpad(areaGeometry, border.width);\n    }\n\n    var gaugeArea = Path.fromRect(areaGeometry, {\n      stroke: {\n        color: border.width ? border.color : \"\",\n        width: border.width,\n        dashType: border.dashType,\n        lineJoin: \"round\",\n        lineCap: \"round\"\n      },\n      fill: {\n        color: options.background\n      }\n    });\n    return gaugeArea;\n  };\n\n  Gauge.prototype._initSurface = function _initSurface() {\n    var ref = this;\n    var options = ref.options;\n    var surface = ref.surface;\n\n    var element = this._surfaceElement();\n\n    var size = this._surfaceSize();\n\n    elementSize(element, size);\n\n    if (!surface || surface.options.type !== options.renderAs) {\n      if (surface) {\n        surface.destroy();\n      }\n\n      this.surface = Surface.create(element, {\n        type: options.renderAs\n      });\n    } else {\n      this.surface.clear();\n      this.surface.resize();\n    }\n  };\n\n  Gauge.prototype._surfaceSize = function _surfaceSize() {\n    var options = this.options;\n\n    var size = this._getSize();\n\n    if (options.gaugeArea) {\n      deepExtend(size, options.gaugeArea);\n    }\n\n    return size;\n  };\n\n  Gauge.prototype._surfaceElement = function _surfaceElement() {\n    if (!this.surfaceElement) {\n      this.surfaceElement = document.createElement('div');\n      this.element.appendChild(this.surfaceElement);\n    }\n\n    return this.surfaceElement;\n  };\n\n  Gauge.prototype.getSize = function getSize() {\n    return this._getSize();\n  };\n\n  Gauge.prototype._getSize = function _getSize() {\n    var element = this.element;\n\n    var defaultSize = this._defaultSize();\n\n    var width = element.offsetWidth;\n    var height = element.offsetHeight;\n\n    if (!width) {\n      width = defaultSize.width;\n    }\n\n    if (!height) {\n      height = defaultSize.height;\n    }\n\n    return {\n      width: width,\n      height: height\n    };\n  };\n\n  Gauge.prototype._defaultSize = function _defaultSize() {\n    return {\n      width: DEFAULT_WIDTH,\n      height: DEFAULT_HEIGHT\n    };\n  };\n\n  Gauge.prototype._toggleTransitions = function _toggleTransitions(value) {\n    var this$1 = this;\n    this.options.transitions = value;\n\n    for (var i = 0; i < this.pointers.length; i++) {\n      this$1.pointers[i].options.animation.transitions = value;\n    }\n  };\n\n  return Gauge;\n}(Class);\n\nsetDefaultOptions(Gauge, {\n  plotArea: {},\n  theme: \"default\",\n  renderAs: \"\",\n  pointer: {},\n  scale: {},\n  gaugeArea: {}\n});\nexport default Gauge;","map":null,"metadata":{},"sourceType":"module"}