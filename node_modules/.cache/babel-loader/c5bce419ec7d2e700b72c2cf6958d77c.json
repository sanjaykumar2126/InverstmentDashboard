{"ast":null,"code":"import { Chart } from '../chart';\nimport { BAR, BULLET, PIE, COLUMN, VERTICAL_BULLET } from '../chart/constants';\nimport { addClass, deepExtend, elementSize, getSpacing, inArray, isArray, isNumber, setDefaultOptions } from '../common';\nimport SharedTooltip from './shared-tooltip';\nvar DEAULT_BAR_WIDTH = 150;\nvar DEAULT_BULLET_WIDTH = 150;\nvar NO_CROSSHAIR = [BAR, BULLET];\n\nfunction hide(children) {\n  var state = [];\n\n  for (var idx = 0; idx < children.length; idx++) {\n    var child = children[idx];\n    state[idx] = child.style.display;\n    child.style.display = \"none\";\n  }\n\n  return state;\n}\n\nfunction show(children, state) {\n  for (var idx = 0; idx < children.length; idx++) {\n    children[idx].style.display = state[idx];\n  }\n}\n\nfunction wrapNumber(value) {\n  return isNumber(value) ? [value] : value;\n}\n\nvar Sparkline = function (Chart) {\n  function Sparkline() {\n    Chart.apply(this, arguments);\n  }\n\n  if (Chart) Sparkline.__proto__ = Chart;\n  Sparkline.prototype = Object.create(Chart && Chart.prototype);\n  Sparkline.prototype.constructor = Sparkline;\n\n  Sparkline.prototype._setElementClass = function _setElementClass(element) {\n    addClass(element, 'k-sparkline');\n  };\n\n  Sparkline.prototype._initElement = function _initElement(element) {\n    Chart.prototype._initElement.call(this, element);\n\n    this._initialWidth = Math.floor(elementSize(element).width);\n  };\n\n  Sparkline.prototype._resize = function _resize() {\n    var element = this.element;\n    var state = hide(element.childNodes);\n    this._initialWidth = Math.floor(elementSize(element).width);\n    show(element.childNodes, state);\n\n    Chart.prototype._resize.call(this);\n  };\n\n  Sparkline.prototype._modelOptions = function _modelOptions() {\n    var chartOptions = this.options;\n\n    var stage = this._surfaceWrap();\n\n    var displayState = hide(stage.childNodes);\n    var space = document.createElement('span');\n    space.innerHTML = '&nbsp;';\n    stage.appendChild(space);\n    var options = deepExtend({\n      width: this._autoWidth,\n      height: elementSize(stage).height,\n      transitions: chartOptions.transitions\n    }, chartOptions.chartArea, {\n      inline: true,\n      align: false\n    });\n    elementSize(stage, {\n      width: options.width,\n      height: options.height\n    });\n    stage.removeChild(space);\n    show(stage.childNodes, displayState);\n\n    if (this.surface) {\n      this.surface.resize();\n    }\n\n    return options;\n  };\n\n  Sparkline.prototype._surfaceWrap = function _surfaceWrap() {\n    if (!this.stage) {\n      var stage = this.stage = document.createElement('span');\n      this.element.appendChild(stage);\n    }\n\n    return this.stage;\n  };\n\n  Sparkline.prototype._createPlotArea = function _createPlotArea(skipSeries) {\n    var plotArea = Chart.prototype._createPlotArea.call(this, skipSeries);\n\n    this._autoWidth = this._initialWidth || this._calculateWidth(plotArea);\n    return plotArea;\n  };\n\n  Sparkline.prototype._calculateWidth = function _calculateWidth(plotArea) {\n    var options = this.options;\n    var margin = getSpacing(options.chartArea.margin);\n    var charts = plotArea.charts;\n\n    var stage = this._surfaceWrap();\n\n    var total = 0;\n\n    for (var i = 0; i < charts.length; i++) {\n      var currentChart = charts[i];\n      var firstSeries = (currentChart.options.series || [])[0];\n\n      if (!firstSeries) {\n        continue;\n      }\n\n      if (firstSeries.type === BAR) {\n        return DEAULT_BAR_WIDTH;\n      }\n\n      if (firstSeries.type === BULLET) {\n        return DEAULT_BULLET_WIDTH;\n      }\n\n      if (firstSeries.type === PIE) {\n        return elementSize(stage).height;\n      }\n\n      var categoryAxis = currentChart.categoryAxis;\n\n      if (categoryAxis) {\n        var pointsCount = categoryAxis.categoriesCount() * (!currentChart.options.isStacked && inArray(firstSeries.type, [COLUMN, VERTICAL_BULLET]) ? currentChart.seriesOptions.length : 1);\n        total = Math.max(total, pointsCount);\n      }\n    }\n\n    var size = total * options.pointWidth;\n\n    if (size > 0) {\n      size += margin.left + margin.right;\n    }\n\n    return size;\n  };\n\n  Sparkline.prototype._createSharedTooltip = function _createSharedTooltip(options) {\n    return new SharedTooltip(this._plotArea, options);\n  };\n\n  Sparkline.normalizeOptions = function normalizeOptions(userOptions) {\n    var options = wrapNumber(userOptions);\n\n    if (isArray(options)) {\n      options = {\n        seriesDefaults: {\n          data: options\n        }\n      };\n    } else {\n      options = deepExtend({}, options);\n    }\n\n    if (!options.series) {\n      options.series = [{\n        data: wrapNumber(options.data)\n      }];\n    }\n\n    deepExtend(options, {\n      seriesDefaults: {\n        type: options.type\n      }\n    });\n\n    if (inArray(options.series[0].type, NO_CROSSHAIR) || inArray(options.seriesDefaults.type, NO_CROSSHAIR)) {\n      options = deepExtend({}, {\n        categoryAxis: {\n          crosshair: {\n            visible: false\n          }\n        }\n      }, options);\n    }\n\n    return options;\n  };\n\n  return Sparkline;\n}(Chart);\n\nsetDefaultOptions(Sparkline, {\n  chartArea: {\n    margin: 2\n  },\n  axisDefaults: {\n    visible: false,\n    majorGridLines: {\n      visible: false\n    },\n    valueAxis: {\n      narrowRange: true\n    }\n  },\n  seriesDefaults: {\n    type: \"line\",\n    area: {\n      line: {\n        width: 0.5\n      }\n    },\n    bar: {\n      stack: true\n    },\n    padding: 2,\n    width: 0.5,\n    overlay: {\n      gradient: null\n    },\n    highlight: {\n      visible: false\n    },\n    border: {\n      width: 0\n    },\n    markers: {\n      size: 2,\n      visible: false\n    }\n  },\n  tooltip: {\n    visible: true,\n    shared: true\n  },\n  categoryAxis: {\n    crosshair: {\n      visible: true,\n      tooltip: {\n        visible: false\n      }\n    }\n  },\n  legend: {\n    visible: false\n  },\n  transitions: false,\n  pointWidth: 5,\n  panes: [{\n    clip: false\n  }]\n});\nexport default Sparkline;","map":null,"metadata":{},"sourceType":"module"}